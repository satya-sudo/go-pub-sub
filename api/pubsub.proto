syntax = "proto3";

package pubsub;
option go_package = "github.com/satya-sudo/go-pub-sub/api;api";

import "google/protobuf/timestamp.proto";
import "google/protobuf/empty.proto";

// === Core Messages ===

// Publish message request
message PublishRequest {
  string topic = 1;
  bytes key = 2;
  bytes value = 3;
  map<string, string> headers = 4;
  int32 partition = 5; // -1 = auto
}

// Broker's response to publish
message PublishResponse {
  string topic = 1;
  int32 partition = 2;
  int64 offset = 3;
  google.protobuf.Timestamp timestamp = 4;
}

// Subscribe request from a consumer
message SubscribeRequest {
  string topic = 1;
  string group = 2;
  int32 partition = 3; // -1 = all
  int64 offset = 4;    // -1 = latest, 0 = earliest
  bool auto_ack = 5;
}

// Message structure sent to consumers
message Message {
  string topic = 1;
  int32 partition = 2;
  int64 offset = 3;
  bytes key = 4;
  bytes value = 5;
  map<string, string> headers = 6;
  google.protobuf.Timestamp timestamp = 7;
}

// Ack request from consumers
message AckRequest {
  string topic = 1;
  int32 partition = 2;
  int64 offset = 3;
  string group = 4;
}

// === Service Definition ===

service PubSub {
  rpc Publish(PublishRequest) returns (PublishResponse);
  rpc Subscribe(SubscribeRequest) returns (stream Message);
  rpc Ack(AckRequest) returns (google.protobuf.Empty);
}
